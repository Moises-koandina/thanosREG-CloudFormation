AWSTemplateFormatVersion: "2010-09-09"

Description: Resources thanos Regional

Parameters:
  env:
    Type: "String"
    Description: Environme  nt name. (dev/qa/prod)
    Default: "dev"
  networkStackName:
    Type: "String"
    Description: networkStackName
    Default: "vpc-devregional-thanos"
  userNameSap:
    Type: "String"
    Description: User Name to connect with SAP
    Default: "thanoscom"
  passSap:
    Type: "String"
    Description: Password to connect with SAP
    Default: "4nd1n4.)!"
  ipSapPbr:
    Type: "String"
    Description: Host to connect with SAP
    Default: "181.42.98.26"
  ipSapQbr:
    Type: "String"
    Description: Host to connect with SAP
    Default: "181.42.96.191"
  ipSapXbr:
    Type: "String"
    Description: Host to connect with SAP
    Default: "181.42.96.148"
  AzureADCognitoARLink:
    Type: "String"
    Description: URL respuesta microsoft AD-Cognito
    Default: "https://login.microsoftonline.com/af5d7ac6-4cdf-4034-a02d-b7ac4a5757f7/federationmetadata/2007-06/federationmetadata.xml?appid=6f1c7b99-dac3-4a33-a9ba-076a2e9a680a"
  AzureADCognitoPYLink:
    Type: "String"
    Description: URL respuesta microsoft AD-Cognito
    Default: "https://login.microsoftonline.com/af5d7ac6-4cdf-4034-a02d-b7ac4a5757f7/federationmetadata/2007-06/federationmetadata.xml?appid=6f1c7b99-dac3-4a33-a9ba-076a2e9a680a"

Resources:
  LayerDataWrangler:
    Type: AWS::Lambda::LayerVersion
    Properties:
      CompatibleRuntimes:
        - python3.9
      Content:
        S3Bucket: !Sub "layer-thanosreg-${env}"
        S3Key: AWSDataW39OriginalAWS.zip
      Description: Layer Data Wrangler
      LayerName: DataWrangler

  LayerPynwrfcLibs:
    Type: AWS::Lambda::LayerVersion
    Properties:
      CompatibleRuntimes:
        - python3.9
      Content:
        S3Bucket: !Sub "layer-thanosreg-${env}"
        S3Key: layer-pynwrfc-libs.zip
      Description: Layer pynwrfc-libs
      LayerName: layer-pynwrfc-libs

  LayerSap:
    Type: AWS::Lambda::LayerVersion
    Properties:
      CompatibleRuntimes:
        - python3.9
      Content:
        S3Bucket: !Sub "layer-thanosreg-${env}"
        S3Key: layer-sap.zip
      Description: Layer SAP
      LayerName: layer-sap

  LayerYml:
    Type: AWS::Lambda::LayerVersion
    Properties:
      CompatibleRuntimes:
        - python3.9
      Content:
        S3Bucket: !Sub "layer-thanosreg-${env}"
        S3Key: layer-yml.zip
      Description: Layer YML
      LayerName: layer-yml

  LayerSns:
    Type: AWS::Lambda::LayerVersion
    Properties:
      CompatibleRuntimes:
        - python3.9
      Content:
        S3Bucket: !Sub "layer-thanosreg-${env}"
        S3Key: layer-sns.zip
      Description: Layer SNS
      LayerName: layer-sns

  SecretManagerSAP:
    Type: "AWS::SecretsManager::Secret"
    Properties:
      Name: extractor/credentials
      Description: Credentials to access RFC SAP
      SecretString: !Sub '{"user" : "${userNameSap}","pass": "${passSap}", "hostPbr": "${ipSapPbr}", "hostQbr": "${ipSapQbr}", "hostXbr": "${ipSapXbr}"}'

  DynamoDBTableIngest:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: ingestThanosReg
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: "run"
          AttributeType: "S"
        - AttributeName: "tablename"
          AttributeType: "S"
      KeySchema:
        - AttributeName: "run"
          KeyType: HASH
        - AttributeName: "tablename"
          KeyType: RANGE

  DynamoDBTableErrorLog:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: errorThanosReg
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: "datetime"
          AttributeType: "S"
      KeySchema:
        - AttributeName: "datetime"
          KeyType: HASH

  DynamoDBTableRun:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: runThanosReg
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: "run"
          AttributeType: "S"
        - AttributeName: "script"
          AttributeType: "S"
      KeySchema:
        - AttributeName: "run"
          KeyType: HASH
        - AttributeName: "script"
          KeyType: RANGE

  DynamoDBTableLogChargeEtl:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: logEtlProcess
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: "filename"
          AttributeType: "S"
        - AttributeName: "fecha"
          AttributeType: "S"
      KeySchema:
        - AttributeName: "filename"
          KeyType: HASH
        - AttributeName: "fecha"
          KeyType: RANGE

  DynamoDBTableL001:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: ModelsL001
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: "fecha"
          AttributeType: "S"
        - AttributeName: "componente"
          AttributeType: "S"
      KeySchema:
        - AttributeName: "fecha"
          KeyType: HASH
        - AttributeName: "componente"
          KeyType: RANGE

  DynamoDBTableL002:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: ModelsL002
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: "fecha"
          AttributeType: "S"
        - AttributeName: "componente"
          AttributeType: "S"
      KeySchema:
        - AttributeName: "fecha"
          KeyType: HASH
        - AttributeName: "componente"
          KeyType: RANGE

  DynamoDBTableL003:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: ModelsL003
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: "fecha"
          AttributeType: "S"
        - AttributeName: "componente"
          AttributeType: "S"
      KeySchema:
        - AttributeName: "fecha"
          KeyType: HASH
        - AttributeName: "componente"
          KeyType: RANGE

  DynamoDBTableOrchest:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: logOrchest
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: "modelo_tabla_cp"
          AttributeType: "S"
        - AttributeName: "fecha_hora"
          AttributeType: "S"
      KeySchema:
        - AttributeName: "modelo_tabla_cp"
          KeyType: HASH
        - AttributeName: "fecha_hora"
          KeyType: RANGE

  DynamoDBContorlDeltas:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: logDeltas
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: "fecha"
          AttributeType: "S"
        - AttributeName: "hora"
          AttributeType: "S"
      KeySchema:
        - AttributeName: "fecha"
          KeyType: HASH
        - AttributeName: "hora"
          KeyType: RANGE

  DynamoDBFiltros:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: modelsFilter
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: "filtro"
          AttributeType: "S"
        - AttributeName: "tipo"
          AttributeType: "S"
      KeySchema:
        - AttributeName: "filtro"
          KeyType: HASH
        - AttributeName: "tipo"
          KeyType: RANGE

  BucketOutput:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub "output-thanos-reg-${env}"
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true

  BucketInput:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub "input-thanos-reg-${env}"
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true

  BucketBackup:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub "backup-thanos-reg-${env}"
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true

  BucketFrontAr:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub "front-ar-thanos-reg-${env}"
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true

  BucketFrontPy:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub "front-py-thanos-reg-${env}"
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true

  BucketFrontCl:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub "front-cl-thanos-reg-${env}"
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true

  SecurityGroupThanosSAP:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: SG para lambda acceda a la VPC
      GroupName: lambdaThanosSAPVpc-SG
      SecurityGroupEgress:
        - IpProtocol: -1
          FromPort: -1
          CidrIp: 0.0.0.0/0
      VpcId: !ImportValue
        "Fn::Sub": "${networkStackName}-VPCID"

  SecurityGroupRDS:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: SG para BD
      GroupName: sgfor-rds-SG
      SecurityGroupIngress:
        - IpProtocol: TCP
          CidrIp: 181.42.160.0/22
          Description: "Redes de Andina VPN"
          FromPort: 3307
          ToPort: 3307
        - IpProtocol: TCP
          SourceSecurityGroupId: !Sub ${SecurityGroupThanosSAP}
          Description: "From Models"
          FromPort: 3307
          ToPort: 3307
      VpcId: !ImportValue
        "Fn::Sub": "${networkStackName}-VPCID"

  #Ingesta + Modelos
  LambdaStatusTransportes:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Modelo L001 AR y PY
      FunctionName: "status-transporte"
      Handler: lambda_function.lambda_handler
      MemorySize: 2048
      Role: !ImportValue ArnIamRoleModels
      Layers: [!Ref "LayerDataWrangler", !Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.9
      Timeout: 180
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}
      VpcConfig:
        SecurityGroupIds:
          - !Ref "SecurityGroupThanosSAP"
        SubnetIds:
          - !ImportValue
            "Fn::Sub": "${networkStackName}-PrivateSubnet1AID"
          - !ImportValue
            "Fn::Sub": "${networkStackName}-PrivateSubnet2AID"

  LambdaStatusPosicionCarga:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Modelo L002 AR y PY
      FunctionName: "status-posicion-carga"
      Handler: lambda_function.lambda_handler
      MemorySize: 2048
      Role: !ImportValue ArnIamRoleModels
      Layers: [!Ref "LayerDataWrangler", !Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.9
      Timeout: 180
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}
      VpcConfig:
        SecurityGroupIds:
          - !Ref "SecurityGroupThanosSAP"
        SubnetIds:
          - !ImportValue
            "Fn::Sub": "${networkStackName}-PrivateSubnet1AID"
          - !ImportValue
            "Fn::Sub": "${networkStackName}-PrivateSubnet2AID"

  LambdaStatusCentro:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Modelo L003 AR y PY
      FunctionName: "status-centro"
      Handler: lambda_function.lambda_handler
      MemorySize: 2048
      Role: !ImportValue ArnIamRoleModels
      Layers: [!Ref "LayerDataWrangler", !Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.9
      Timeout: 180
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}
      VpcConfig:
        SecurityGroupIds:
          - !Ref "SecurityGroupThanosSAP"
        SubnetIds:
          - !ImportValue
            "Fn::Sub": "${networkStackName}-PrivateSubnet1AID"
          - !ImportValue
            "Fn::Sub": "${networkStackName}-PrivateSubnet2AID"

  LambdasapToAws:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Lambda Extractora from SAP
      FunctionName: "sap-to-aws"
      Handler: lambda_function.lambda_handler
      MemorySize: 2048
      Role: !ImportValue ArnIamRoleExtractor
      Layers:
        [
          !Ref "LayerDataWrangler",
          !Ref "LayerPynwrfcLibs",
          !Ref "LayerSap",
          !Ref "LayerYml",
          !Ref "LayerSns",
        ]
      Runtime: python3.9
      Timeout: 180
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}
      VpcConfig:
        SecurityGroupIds:
          - !Ref "SecurityGroupThanosSAP"
        SubnetIds:
          - !ImportValue
            "Fn::Sub": "${networkStackName}-PrivateSubnet1AID"
          - !ImportValue
            "Fn::Sub": "${networkStackName}-PrivateSubnet2AID"

  LambdaEtl:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: ETL ingesta
      FunctionName: "etl-ingesta"
      Handler: lambda_function.lambda_handler
      MemorySize: 1024
      Role: !ImportValue ArnIamRoleExtractor
      Layers: [!Ref "LayerDataWrangler", !Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.9
      Timeout: 50
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}
      VpcConfig:
        SecurityGroupIds:
          - !Ref "SecurityGroupThanosSAP"
        SubnetIds:
          - !ImportValue
            "Fn::Sub": "${networkStackName}-PrivateSubnet1AID"
          - !ImportValue
            "Fn::Sub": "${networkStackName}-PrivateSubnet2AID"

  LambdaMakeCatalog:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Modelo L003 AR y PY
      FunctionName: "create-all-tables"
      Handler: lambda_function.lambda_handler
      MemorySize: 1024
      Role: !ImportValue ArnIamRoleModels
      Layers: [!Ref "LayerDataWrangler", !Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.9
      Timeout: 180
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}
      VpcConfig:
        SecurityGroupIds:
          - !Ref "SecurityGroupThanosSAP"
        SubnetIds:
          - !ImportValue
            "Fn::Sub": "${networkStackName}-PrivateSubnet1AID"
          - !ImportValue
            "Fn::Sub": "${networkStackName}-PrivateSubnet2AID"

  LambdaNotifySystem:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Modelo L003 AR y PY
      FunctionName: "wake-up-notify-system"
      Handler: lambda_function.lambda_handler
      MemorySize: 1024
      Role: !ImportValue ArnIamRoleModels
      Layers: [!Ref "LayerDataWrangler", !Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.9
      Timeout: 180
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  #APIs Argentinas
  LambdaStatusTransportesApiA:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "ar-status-transporte-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Layers: [!Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.9
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaStatusCentroCApiA:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "ar-status-centro-c-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Layers: [!Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.9
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaStatusCentroTApiA:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "ar-status-centro-t-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Runtime: python3.9
      Layers: [!Ref "LayerYml", !Ref "LayerSns"]
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaStatusPosicionCargaApiA:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "ar-status-posicion-carga-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Layers: [!Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.9
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaStatusPosicionCargaPApiA:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "ar-status-posicion-carga-p-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Layers: [!Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.9
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaMenuApiA:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "ar-menu-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Layers: [!Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.9
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaFiltrosApiA:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "ar-filtros-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Layers: [!Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.9
      Timeout: 30
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaDateupdateApiA:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "ar-fecha-actualizacion-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Layers: [!Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.9
      Timeout: 30
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  #APIs Paraguay
  LambdaStatusTransportesApiP:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "py-status-transporte-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Layers: [!Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.9
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaStatusCentroCApiP:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "py-status-centro-c-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Layers: [!Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.9
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaStatusCentroTApiP:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "py-status-centro-t-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Layers: [!Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.9
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaStatusPosicionCargaApiP:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "py-status-posicion-carga-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Layers: [!Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.9
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaStatusPosicionCargaPApiP:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "py-status-posicion-carga-p-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Layers: [!Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.9
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaMenuApiP:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "py-menu-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Layers: [!Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.9
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaFiltrosApiP:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "py-filtros-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Layers: [!Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.9
      Timeout: 30
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaDateupdateApiP:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "py-fecha-actualizacion-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Layers: [!Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.9
      Timeout: 30
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  # Log Groups
  LogGroupRegFechaActualizacionApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaDateupdateApiA}"
      RetentionInDays: 5

  LogGroupRegFiltrosApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaFiltrosApiA}"
      RetentionInDays: 5

  LogGroupRegMenuApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaMenuApiA}"
      RetentionInDays: 5

  LogGroupRegStatusCentroCApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusCentroCApiA}"
      RetentionInDays: 5

  LogGroupRegStatusCentroTApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusCentroTApiA}"
      RetentionInDays: 5

  LogGroupRegStatusPosicionCargaApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusPosicionCargaApiA}"
      RetentionInDays: 5

  LogGroupRegStatusPosicionCargaPApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusPosicionCargaPApiA}"
      RetentionInDays: 5

  LogGroupRegStatusTransporteApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusTransportesApiA}"
      RetentionInDays: 5

  LogGroupRegCreateAllTables:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaMakeCatalog}"
      RetentionInDays: 5

  LogGroupRegPyFiltrosApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaFiltrosApiP}"
      RetentionInDays: 5

  LogGroupRegPyMenuApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaMenuApiP}"
      RetentionInDays: 5

  LogGroupRegPyStatusCentroCApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusCentroCApiP}"
      RetentionInDays: 5

  LogGroupRegPyStatusCentroTApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusCentroTApiP}"
      RetentionInDays: 5

  LogGroupRegPyStatusPosicionCargaApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusPosicionCargaApiP}"
      RetentionInDays: 5

  LogGroupRegPyStatusPosicionCargaPApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusPosicionCargaPApiP}"
      RetentionInDays: 5

  LogGroupRegPyStatusTransporteApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusTransportesApiP}"
      RetentionInDays: 5

  LogGroupRegSapToAws:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdasapToAws}"
      RetentionInDays: 5

  LogGroupRegStatusCentro:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusCentro}"
      RetentionInDays: 5

  LogGroupRegStatusPosicionCarga:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusPosicionCarga}"
      RetentionInDays: 5

  LogGroupRegStatusTransporte:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusTransportes}"
      RetentionInDays: 5

  LogGroupRegWakeUpNotifySystem:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaNotifySystem}"
      RetentionInDays: 5

  OriginAccessIdAr:
    Type: AWS::CloudFront::CloudFrontOriginAccessIdentity
    Properties:
      CloudFrontOriginAccessIdentityConfig:
        Comment: !Sub "ar-${env} s3's OAI"

  OriginAccessIdPy:
    Type: AWS::CloudFront::CloudFrontOriginAccessIdentity
    Properties:
      CloudFrontOriginAccessIdentityConfig:
        Comment: !Sub "py-${env} s3's OAI"

  BucketPolicyAR:
    Type: AWS::S3::BucketPolicy
    Properties:
      Bucket: !Sub "front-ar-thanos-reg-${env}/*"
      PolicyDocument:
        Id: !Sub "PolicyForCloudFrontPrivateContent-front-ar-thanos-reg-${env}"
        Statement:
          - Sid: "1"
            Effect: Allow
            Principal:
              AWS: !Sub "arn:aws:iam::cloudfront:user/CloudFront Origin Access Identity ${OriginAccessIdAr}"
            Action: s3:GetObject
            Resource: !Sub "arn:aws:s3:::front-ar-thanos-reg-${env}/*"

  BucketPolicyPY:
    Type: AWS::S3::BucketPolicy
    Properties:
      Bucket: !Sub "front-py-thanos-reg-${env}/*"
      PolicyDocument:
        Id: !Sub "PolicyForCloudFrontPrivateContent-front-py-thanos-reg-${env}"
        Statement:
          - Sid: "1"
            Effect: Allow
            Principal:
              AWS: !Sub "arn:aws:iam::cloudfront:user/CloudFront Origin Access Identity ${OriginAccessIdPy}"
            Action: s3:GetObject
            Resource: !Sub "arn:aws:s3:::front-py-thanos-reg-${env}/*"

  SHThanosAr:
    Type: AWS::CloudFront::Function
    Properties:
      AutoPublish: true
      FunctionCode: |
        function handler(event) {
          var response = event.response;
          var headers = response.headers;

          headers['strict-transport-security'] = { value: 'max-age=63072000'}; 
          headers['x-xss-protection'] = {value: '1; mode=block'};
          headers['x-frame-options'] = {value: 'DENY'};
          headers['x-content-type-options'] = { value: 'nosniff'};

          return response;
        }
      FunctionConfig:
        Comment: !Sub "Apply security headers on ${env}"
        Runtime: cloudfront-js-1.0
      Name: SHThanosAr

  SHThanosPy:
    Type: AWS::CloudFront::Function
    Properties:
      AutoPublish: true
      FunctionCode: |
        function handler(event) {
          var response = event.response;
          var headers = response.headers;

          headers['strict-transport-security'] = { value: 'max-age=63072000'}; 
          headers['x-xss-protection'] = {value: '1; mode=block'};
          headers['x-frame-options'] = {value: 'DENY'};
          headers['x-content-type-options'] = { value: 'nosniff'};

          return response;
        }
      FunctionConfig:
        Comment: !Sub "Apply security headers on ${env}"
        Runtime: cloudfront-js-1.0
      Name: SHThanosPy

  CloudFrontAr:
    Type: AWS::CloudFront::Distribution
    Properties:
      DistributionConfig:
        DefaultCacheBehavior:
          AllowedMethods:
            - "GET"
            - "HEAD"
            - "OPTIONS"
          CachePolicyId: "658327ea-f89d-4fab-a63d-7e88639e58f6"
          TargetOriginId: !Sub "front-ar-thanos-reg-${env}"
          ViewerProtocolPolicy: "allow-all"
          FunctionAssociations:
            - EventType: viewer-request
              FunctionARN: !GetAtt SHThanosAr.FunctionMetadata.FunctionARN
        Comment: !Sub "Cloudfront Distribution - ar-thanos-reg-${env}"
        DefaultRootObject: "index.html"
        Enabled: "true"
        IPV6Enabled: "false"
        Origins:
          - S3OriginConfig:
              OriginAccessIdentity: !Sub "origin-access-identity/cloudfront/${OriginAccessIdAr}"
            Id: !Sub "front-ar-thanos-reg-${env}"
            DomainName: !Sub "front-ar-thanos-reg-${env}.s3.${AWS::Region}.amazonaws.com"
        WebACLId: !GetAtt wafARCDF.Arn

  CloudFrontPy:
    Type: AWS::CloudFront::Distribution
    Properties:
      DistributionConfig:
        DefaultCacheBehavior:
          AllowedMethods:
            - "GET"
            - "HEAD"
            - "OPTIONS"
          CachePolicyId: "658327ea-f89d-4fab-a63d-7e88639e58f6"
          TargetOriginId: !Sub "front-py-thanos-reg-${env}"
          ViewerProtocolPolicy: "allow-all"
          FunctionAssociations:
            - EventType: viewer-request
              FunctionARN: !GetAtt SHThanosPy.FunctionMetadata.FunctionARN
        Comment: !Sub "Cloudfront Distribution - py-thanos-reg-${env}"
        DefaultRootObject: "index.html"
        Enabled: "true"
        IPV6Enabled: "false"
        Origins:
          - S3OriginConfig:
              OriginAccessIdentity: !Sub "origin-access-identity/cloudfront/${OriginAccessIdPy}"
            Id: !Sub "front-py-thanos-reg-${env}"
            DomainName: !Sub "front-py-thanos-reg-${env}.s3.${AWS::Region}.amazonaws.com"
        WebACLId: !GetAtt wafPYCDF.Arn

  IpSetAR:
    Type: AWS::WAFv2::IPSet
    Properties:
      Description: "IPs publicas Andina"
      Name: !Sub "IPs-${AWS::StackName}-AR-${env}"
      Scope: CLOUDFRONT
      IPAddressVersion: IPV4
      Addresses:
        - "190.215.193.68/32"
        - "190.215.193.69/32"
        - "190.215.193.70/32"
        - "200.70.33.66/32"
        - "190.221.175.4/32"
        - "181.13.90.170/32"

  wafARCDF:
    Type: AWS::WAFv2::WebACL
    DependsOn:
      - IpSetAR
    Properties:
      Name: !Sub "WAF-${AWS::StackName}-AR-${env}"
      Scope: CLOUDFRONT
      DefaultAction:
        Block: {}
      Description: "Permitir acceso IP publica Andina"
      Rules:
        - Name: "RedAndina"
          Priority: 0
          Statement:
            IPSetReferenceStatement:
              ARN: !GetAtt IpSetAR.Arn
          Action:
            Allow: {}
          VisibilityConfig:
            SampledRequestsEnabled: true
            CloudWatchMetricsEnabled: true
            MetricName: "IpLimitationRule"
      VisibilityConfig:
        SampledRequestsEnabled: true
        CloudWatchMetricsEnabled: true
        MetricName: "WebACLMetric"
      Capacity: 1

  IpSetPY:
    Type: AWS::WAFv2::IPSet
    Properties:
      Description: "IPs publicas Andina"
      Name: !Sub "IPs-${AWS::StackName}-PY-${env}"
      Scope: CLOUDFRONT
      IPAddressVersion: IPV4
      Addresses:
        - "190.215.193.68/32"
        - "190.215.193.69/32"
        - "190.215.193.70/32"
        - "200.70.33.66/32"
        - "190.221.175.4/32"
        - "181.13.90.170/32"

  wafPYCDF:
    Type: AWS::WAFv2::WebACL
    DependsOn:
      - IpSetPY
    Properties:
      Name: !Sub "WAF-${AWS::StackName}-PY-${env}"
      Scope: CLOUDFRONT
      DefaultAction:
        Block: {}
      Description: "Permitir acceso IP publica Andina"
      Rules:
        - Name: "RedAndina"
          Priority: 0
          Statement:
            IPSetReferenceStatement:
              ARN: !GetAtt IpSetPY.Arn
          Action:
            Allow: {}
          VisibilityConfig:
            SampledRequestsEnabled: true
            CloudWatchMetricsEnabled: true
            MetricName: "IpLimitationRule"
      VisibilityConfig:
        SampledRequestsEnabled: true
        CloudWatchMetricsEnabled: true
        MetricName: "WebACLMetric"
      Capacity: 1

  IpSetARApi:
    Type: AWS::WAFv2::IPSet
    Properties:
      Description: "IPs publicas Andina"
      Name: !Sub "IPs-${AWS::StackName}-AR-API-${env}"
      Scope: REGIONAL
      IPAddressVersion: IPV4
      Addresses:
        - "190.215.193.68/32"
        - "190.215.193.69/32"
        - "190.215.193.70/32"
        - "200.70.33.66/32"
        - "190.221.175.4/32"
        - "181.13.90.170/32"

  wafARCDFApi:
    Type: AWS::WAFv2::WebACL
    DependsOn:
      - IpSetARApi
    Properties:
      Name: !Sub "WAF-${AWS::StackName}-AR-API-${env}"
      Scope: REGIONAL
      DefaultAction:
        Block: {}
      Description: "Permitir acceso IP publica Andina"
      Rules:
        - Name: "RedAndina"
          Priority: 0
          Statement:
            IPSetReferenceStatement:
              ARN: !GetAtt IpSetARApi.Arn
          Action:
            Allow: {}
          VisibilityConfig:
            SampledRequestsEnabled: true
            CloudWatchMetricsEnabled: true
            MetricName: "IpLimitationRule"
      VisibilityConfig:
        SampledRequestsEnabled: true
        CloudWatchMetricsEnabled: true
        MetricName: "WebACLMetric"
      Capacity: 1

  EventRuleLambdaSAP:
    Type: AWS::Events::Rule
    Properties:
      Name: ThanosReg
      Description: Inicia la Extraccion SAP
      State: DISABLED
      ScheduleExpression: cron(*/20 * * * ? *)
      Targets:
        - Arn: !GetAtt LambdasapToAws.Arn
          Id: "TargetLambdaSAP"

  EventBridgeLambdaSAPPermission:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !GetAtt LambdasapToAws.Arn
      Action: lambda:InvokeFunction
      Principal: events.amazonaws.com
      SourceArn: !GetAtt EventRuleLambdaSAP.Arn

Outputs:
  LambdaDateupdateApiA:
    Value: !GetAtt LambdaDateupdateApiA.Arn
    Description: api LambdaDateupdateApiA
    Export:
      Name: "LambdaDateupdateApiA"

  LambdaFiltrosApiA:
    Value: !GetAtt LambdaFiltrosApiA.Arn
    Description: api LambdaFiltrosApiA
    Export:
      Name: "LambdaFiltrosApiA"

  LambdaMenuApiA:
    Value: !GetAtt LambdaMenuApiA.Arn
    Description: api LambdaMenuApiA
    Export:
      Name: "LambdaMenuApiA"

  LambdaStatusPosicionCargaPApiA:
    Value: !GetAtt LambdaStatusPosicionCargaPApiA.Arn
    Description: api LambdaStatusPosicionCargaPApiA
    Export:
      Name: "LambdaStatusPosicionCargaPApiA"

  LambdaStatusPosicionCargaApiA:
    Value: !GetAtt LambdaStatusPosicionCargaApiA.Arn
    Description: api LambdaStatusPosicionCargaApiA
    Export:
      Name: "LambdaStatusPosicionCargaApiA"

  LambdaStatusCentroCApiA:
    Value: !GetAtt LambdaStatusCentroCApiA.Arn
    Description: api LambdaStatusCentroCApiA
    Export:
      Name: "LambdaStatusCentroCApiA"

  LambdaStatusCentroTApiA:
    Value: !GetAtt LambdaStatusCentroTApiA.Arn
    Description: api LambdaStatusCentroTApiA
    Export:
      Name: "LambdaStatusCentroTApiA"

  LambdaStatusTransportesApiA:
    Value: !GetAtt LambdaStatusTransportesApiA.Arn
    Description: api LambdaStatusTransportesApiA
    Export:
      Name: "LambdaStatusTransportesApiA"

  LambdaDateupdateApiP:
    Value: !GetAtt LambdaDateupdateApiP.Arn
    Description: api LambdaDateupdateApiP
    Export:
      Name: "LambdaDateupdateApiP"

  LambdaFiltrosApiP:
    Value: !GetAtt LambdaFiltrosApiP.Arn
    Description: api LambdaFiltrosApiP
    Export:
      Name: "LambdaFiltrosApiP"

  LambdaMenuApiP:
    Value: !GetAtt LambdaMenuApiP.Arn
    Description: api LambdaMenuApiP
    Export:
      Name: "LambdaMenuApiP"

  LambdaStatusPosicionCargaPApiP:
    Value: !GetAtt LambdaStatusPosicionCargaPApiP.Arn
    Description: api LambdaStatusPosicionCargaPApiP
    Export:
      Name: "LambdaStatusPosicionCargaPApiP"

  LambdaStatusPosicionCargaApiP:
    Value: !GetAtt LambdaStatusPosicionCargaApiP.Arn
    Description: api LambdaStatusPosicionCargaApiP
    Export:
      Name: "LambdaStatusPosicionCargaApiP"

  LambdaStatusCentroCApiP:
    Value: !GetAtt LambdaStatusCentroCApiP.Arn
    Description: api LambdaStatusCentroCApiP
    Export:
      Name: "LambdaStatusCentroCApiP"

  LambdaStatusCentroTApiP:
    Value: !GetAtt LambdaStatusCentroTApiP.Arn
    Description: api LambdaStatusCentroTApiP
    Export:
      Name: "LambdaStatusCentroTApiP"

  LambdaStatusTransportesApiP:
    Value: !GetAtt LambdaStatusTransportesApiP.Arn
    Description: api LambdaStatusTransportesApiP
    Export:
      Name: "LambdaStatusTransportesApiP"
