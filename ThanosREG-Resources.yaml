AWSTemplateFormatVersion: "2010-09-09"

Description: Resources thanos Regional

Parameters:
  env:
    Type: "String"
    Description: Environme  nt name. (dev/qa/prod)
    Default: "dev"
  networkStackName:
    Type: "String"
    Description: networkStackName
    Default: "vpc-devregional-thanos"
  userNameSap:
    Type: "String"
    Description: User Name to connect with SAP
    Default: "thanoscom"
  passSap:
    Type: "String"
    Description: Password to connect with SAP
    Default: "4nd1n4.)!"
  ipSapPbr:
    Type: "String"
    Description: Host to connect with SAP
    Default: "181.42.98.26"
  ipSapQbr:
    Type: "String"
    Description: Host to connect with SAP
    Default: "181.42.96.191"
  ipSapXbr:
    Type: "String"
    Description: Host to connect with SAP
    Default: "181.42.96.148"

Resources:
  LayerDataWrangler:
    Type: AWS::Lambda::LayerVersion
    Properties:
      CompatibleRuntimes:
        - python3.7
        - python3.8
      Content:
        S3Bucket: !Sub "layer-thanosreg-${env}"
        S3Key: DataWrangler.zip
      Description: Layer Data Wrangler
      LayerName: DataWrangler

  LayerPynwrfcLibs:
    Type: AWS::Lambda::LayerVersion
    Properties:
      CompatibleRuntimes:
        - python3.7
        - python3.8
      Content:
        S3Bucket: !Sub "layer-thanosreg-${env}"
        S3Key: layer-pynwrfc-libs.zip
      Description: Layer pynwrfc-libs
      LayerName: layer-pynwrfc-libs

  LayerSap:
    Type: AWS::Lambda::LayerVersion
    Properties:
      CompatibleRuntimes:
        - python3.7
        - python3.8
      Content:
        S3Bucket: !Sub "layer-thanosreg-${env}"
        S3Key: layer-sap.zip
      Description: Layer SAP
      LayerName: layer-sap

  LayerYml:
    Type: AWS::Lambda::LayerVersion
    Properties:
      CompatibleRuntimes:
        - python3.7
        - python3.8
        - python3.9
      Content:
        S3Bucket: !Sub "layer-thanosreg-${env}"
        S3Key: layer-yml.zip
      Description: Layer YML
      LayerName: layer-yml

  LayerSns:
    Type: AWS::Lambda::LayerVersion
    Properties:
      CompatibleRuntimes:
        - python3.7
        - python3.8
        - python3.9
      Content:
        S3Bucket: !Sub "layer-thanosreg-${env}"
        S3Key: layer-sns.zip
      Description: Layer SNS
      LayerName: layer-sns

  SecretManagerSAP:
    Type: "AWS::SecretsManager::Secret"
    Properties:
      Name: extractor/credentials
      Description: Credentials to access RFC SAP
      SecretString: !Sub '{"user" : "${userNameSap}","pass": "${passSap}", "hostPbr": "${ipSapPbr}", "hostQbr": "${ipSapQbr}", "hostXbr": "${ipSapXbr}"}'

  DynamoDBTableIngest:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: ingestThanosReg
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: "run"
          AttributeType: "S"
        - AttributeName: "tablename"
          AttributeType: "S"
      KeySchema:
        - AttributeName: "run"
          KeyType: HASH
        - AttributeName: "tablename"
          KeyType: RANGE

  DynamoDBTableErrorLog:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: errorThanosReg
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: "datetime"
          AttributeType: "S"
      KeySchema:
        - AttributeName: "datetime"
          KeyType: HASH

  DynamoDBTableRun:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: runThanosReg
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: "run"
          AttributeType: "S"
        - AttributeName: "script"
          AttributeType: "S"
      KeySchema:
        - AttributeName: "run"
          KeyType: HASH
        - AttributeName: "script"
          KeyType: RANGE

  DynamoDBTableLogChargeEtl:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: logEtlProcess
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: "filename"
          AttributeType: "S"
        - AttributeName: "fecha"
          AttributeType: "S"
      KeySchema:
        - AttributeName: "filename"
          KeyType: HASH
        - AttributeName: "fecha"
          KeyType: RANGE

  DynamoDBTableL001:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: ModelsL001
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: "fecha"
          AttributeType: "S"
        - AttributeName: "componente"
          AttributeType: "S"
      KeySchema:
        - AttributeName: "fecha"
          KeyType: HASH
        - AttributeName: "componente"
          KeyType: RANGE

  DynamoDBTableL002:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: ModelsL002
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: "fecha"
          AttributeType: "S"
        - AttributeName: "componente"
          AttributeType: "S"
      KeySchema:
        - AttributeName: "fecha"
          KeyType: HASH
        - AttributeName: "componente"
          KeyType: RANGE

  DynamoDBTableL003:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: ModelsL003
      BillingMode: PAY_PER_REQUEST
      AttributeDefinitions:
        - AttributeName: "fecha"
          AttributeType: "S"
        - AttributeName: "componente"
          AttributeType: "S"
      KeySchema:
        - AttributeName: "fecha"
          KeyType: HASH
        - AttributeName: "componente"
          KeyType: RANGE

  BucketOutput:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub "output-thanos-reg-${env}"
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true

  BucketInput:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub "input-thanos-reg-${env}"
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true

  BucketBackup:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub "backup-thanos-reg-${env}"
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true

  BucketFrontAr:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub "front-ar-thanos-reg-${env}"
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true

  BucketFrontPy:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub "front-py-thanos-reg-${env}"
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true

  BucketFrontCl:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub "front-cl-thanos-reg-${env}"
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true

  SecurityGroupThanosSAP:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: SG para lambda acceda a la VPC
      GroupName: lambdaThanosSAPVpc-SG
      SecurityGroupEgress:
        - IpProtocol: -1
          FromPort: -1
          CidrIp: 0.0.0.0/0
      VpcId: !ImportValue
        "Fn::Sub": "${networkStackName}-VPCID"

  #Ingesta + Modelos
  LambdaStatusTransportes:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Modelo L001 AR y PY
      FunctionName: "status-transporte"
      Handler: lambda_function.lambda_handler
      MemorySize: 2048
      Role: !ImportValue ArnIamRoleModels
      Layers: [!Ref "LayerDataWrangler", !Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.8
      Timeout: 180
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaStatusPosicionCarga:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Modelo L002 AR y PY
      FunctionName: "status-posicion-carga"
      Handler: lambda_function.lambda_handler
      MemorySize: 2048
      Role: !ImportValue ArnIamRoleModels
      Layers: [!Ref "LayerDataWrangler", !Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.8
      Timeout: 180
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaStatusCentro:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Modelo L003 AR y PY
      FunctionName: "status-centro"
      Handler: lambda_function.lambda_handler
      MemorySize: 2048
      Role: !ImportValue ArnIamRoleModels
      Layers: [!Ref "LayerDataWrangler", !Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.8
      Timeout: 180
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdasapToAws:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Lambda Extractora from SAP
      FunctionName: "sap-to-aws"
      Handler: lambda_function.lambda_handler
      MemorySize: 2048
      Role: !ImportValue ArnIamRoleExtractor
      Layers:
        [!Ref "LayerDataWrangler", !Ref "LayerPynwrfcLibs", !Ref "LayerSap"]
      Runtime: python3.7
      Timeout: 180
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}
      VpcConfig:
        SecurityGroupIds:
          - !Ref "SecurityGroupThanosSAP"
        SubnetIds:
          - !ImportValue
            "Fn::Sub": "${networkStackName}-PrivateSubnet1AID"
          - !ImportValue
            "Fn::Sub": "${networkStackName}-PrivateSubnet2AID"

  LambdaEtl:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: ETL ingesta
      FunctionName: "etl-ingesta"
      Handler: lambda_function.lambda_handler
      MemorySize: 1024
      Role: !ImportValue ArnIamRoleModels
      Layers: [!Ref "LayerDataWrangler", !Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.8
      Timeout: 50
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaMakeCatalog:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Modelo L003 AR y PY
      FunctionName: "create-all-tables"
      Handler: lambda_function.lambda_handler
      MemorySize: 1024
      Role: !ImportValue ArnIamRoleModels
      Layers: [!Ref "LayerDataWrangler", !Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.8
      Timeout: 180
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaNotifySystem:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Modelo L003 AR y PY
      FunctionName: "wake-up-notify-system"
      Handler: lambda_function.lambda_handler
      MemorySize: 1024
      Role: !ImportValue ArnIamRoleModels
      Layers: [!Ref "LayerDataWrangler", !Ref "LayerYml", !Ref "LayerSns"]
      Runtime: python3.8
      Timeout: 180
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  #APIs Argentinas
  LambdaStatusTransportesApiA:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "ar-status-transporte-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Runtime: python3.8
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaStatusCentroCApiA:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "ar-status-centro-c-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Runtime: python3.8
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaStatusCentroTApiA:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "ar-status-centro-t-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Runtime: python3.8
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaStatusPosicionCargaApiA:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "ar-status-posicion-carga-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Runtime: python3.8
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaStatusPosicionCargaPApiA:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "ar-status-posicion-carga-p-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Runtime: python3.8
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaMenuApiA:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "ar-menu-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Runtime: python3.8
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaFiltrosApiA:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "ar-filtros-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Runtime: python3.8
      Timeout: 30
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaDateupdateApiA:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "ar-fecha-actualizacion-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Runtime: python3.8
      Timeout: 30
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  #APIs Paraguay
  LambdaStatusTransportesApiP:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "py-status-transporte-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Runtime: python3.8
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaStatusCentroCApiP:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "py-status-centro-c-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Runtime: python3.8
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaStatusCentroTApiP:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "py-status-centro-t-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Runtime: python3.8
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaStatusPosicionCargaApiP:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "py-status-posicion-carga-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Runtime: python3.8
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaStatusPosicionCargaPApiP:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "py-status-posicion-carga-p-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Runtime: python3.8
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaMenuApiP:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "py-menu-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Runtime: python3.8
      Timeout: 20
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaFiltrosApiP:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "py-filtros-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Runtime: python3.8
      Timeout: 30
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  LambdaDateupdateApiP:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
            return {
                'statusCode': 200,
                'body': json.dumps('success')
            }
      Description: Linked with API Gateway
      FunctionName: "py-fecha-actualizacion-api"
      Handler: lambda_function.lambda_handler
      MemorySize: 256
      Role: !ImportValue ArnIamRoleApi
      Runtime: python3.8
      Timeout: 30
      Environment:
        Variables:
          ENVIRONMENT: !Ref "env"
          PROYECTO: "Thanos-Regional"
          ID_ACCOUNT: !Sub ${AWS::AccountId}
          REGION: !Sub ${AWS::Region}

  # Log Groups
  LogGroupRegFechaActualizacionApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaDateupdateApiA}"
      RetentionInDays: 5

  LogGroupRegFiltrosApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaFiltrosApiA}"
      RetentionInDays: 5

  LogGroupRegMenuApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaMenuApiA}"
      RetentionInDays: 5

  LogGroupRegStatusCentroCApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusCentroCApiA}"
      RetentionInDays: 5

  LogGroupRegStatusCentroTApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusCentroTApiA}"
      RetentionInDays: 5

  LogGroupRegStatusPosicionCargaApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusPosicionCargaApiA}"
      RetentionInDays: 5

  LogGroupRegStatusPosicionCargaPApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusPosicionCargaPApiA}"
      RetentionInDays: 5

  LogGroupRegStatusTransporteApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusTransportesApiA}"
      RetentionInDays: 5

  LogGroupRegCreateAllTables:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaMakeCatalog}"
      RetentionInDays: 5

  LogGroupRegPyFiltrosApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaFiltrosApiP}"
      RetentionInDays: 5

  LogGroupRegPyMenuApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaMenuApiP}"
      RetentionInDays: 5

  LogGroupRegPyStatusCentroCApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusCentroCApiP}"
      RetentionInDays: 5

  LogGroupRegPyStatusCentroTApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusCentroTApiP}"
      RetentionInDays: 5

  LogGroupRegPyStatusPosicionCargaApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusPosicionCargaApiP}"
      RetentionInDays: 5

  LogGroupRegPyStatusPosicionCargaPApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusPosicionCargaPApiP}"
      RetentionInDays: 5

  LogGroupRegPyStatusTransporteApi:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusTransportesApiP}"
      RetentionInDays: 5

  LogGroupRegSapToAws:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdasapToAws}"
      RetentionInDays: 5

  LogGroupRegStatusCentro:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusCentro}"
      RetentionInDays: 5

  LogGroupRegStatusPosicionCarga:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusPosicionCarga}"
      RetentionInDays: 5

  LogGroupRegStatusTransporte:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaStatusTransportes}"
      RetentionInDays: 5

  LogGroupRegWakeUpNotifySystem:
    Type: "AWS::Logs::LogGroup"
    Properties:
      LogGroupName: !Sub "/aws/lambda/${LambdaNotifySystem}"
      RetentionInDays: 5

  OriginAccessIdAr:
    Type: AWS::CloudFront::CloudFrontOriginAccessIdentity
    Properties:
      CloudFrontOriginAccessIdentityConfig:
        Comment: !Sub "ar-${env} s3's OAI"

  OriginAccessIdPy:
    Type: AWS::CloudFront::CloudFrontOriginAccessIdentity
    Properties:
      CloudFrontOriginAccessIdentityConfig:
        Comment: !Sub "py-${env} s3's OAI"

  BucketPolicyAR:
    Type: AWS::S3::BucketPolicy
    Properties:
      Bucket: !Sub "front-ar-thanos-reg-${env}/*"
      PolicyDocument:
        Id: !Sub "PolicyForCloudFrontPrivateContent-front-ar-thanos-reg-${env}"
        Statement:
          - Sid: "1"
            Effect: Allow
            Principal:
              AWS: !Sub "arn:aws:iam::cloudfront:user/CloudFront Origin Access Identity ${OriginAccessIdAr}"
            Action: s3:GetObject
            Resource: !Sub "arn:aws:s3:::front-ar-thanos-reg-${env}/*"

  BucketPolicyPY:
    Type: AWS::S3::BucketPolicy
    Properties:
      Bucket: !Sub "front-py-thanos-reg-${env}/*"
      PolicyDocument:
        Id: !Sub "PolicyForCloudFrontPrivateContent-front-py-thanos-reg-${env}"
        Statement:
          - Sid: "1"
            Effect: Allow
            Principal:
              AWS: !Sub "arn:aws:iam::cloudfront:user/CloudFront Origin Access Identity ${OriginAccessIdPy}"
            Action: s3:GetObject
            Resource: !Sub "arn:aws:s3:::front-py-thanos-reg-${env}/*"

  CloudFrontAr:
    Type: AWS::CloudFront::Distribution
    Properties:
      DistributionConfig:
        DefaultCacheBehavior:
          AllowedMethods:
            - "GET"
            - "HEAD"
            - "OPTIONS"
          CachePolicyId: "658327ea-f89d-4fab-a63d-7e88639e58f6"
          TargetOriginId: !Sub "front-ar-thanos-reg-${env}"
          ViewerProtocolPolicy: "allow-all"
        Comment: !Sub "Cloudfront Distribution - ar-thanos-reg-${env}"
        DefaultRootObject: "index.html"
        Enabled: "true"
        IPV6Enabled: "false"
        Origins:
          - S3OriginConfig:
              OriginAccessIdentity: !Sub "origin-access-identity/cloudfront/${OriginAccessIdAr}"
            Id: !Sub "front-ar-thanos-reg-${env}"
            DomainName: !Sub "front-ar-thanos-reg-${env}.s3.${AWS::Region}.amazonaws.com"

  CloudFrontPy:
    Type: AWS::CloudFront::Distribution
    Properties:
      DistributionConfig:
        DefaultCacheBehavior:
          AllowedMethods:
            - "GET"
            - "HEAD"
            - "OPTIONS"
          CachePolicyId: "658327ea-f89d-4fab-a63d-7e88639e58f6"
          TargetOriginId: !Sub "front-py-thanos-reg-${env}"
          ViewerProtocolPolicy: "allow-all"
        Comment: !Sub "Cloudfront Distribution - py-thanos-reg-${env}"
        DefaultRootObject: "index.html"
        Enabled: "true"
        IPV6Enabled: "false"
        Origins:
          - S3OriginConfig:
              OriginAccessIdentity: !Sub "origin-access-identity/cloudfront/${OriginAccessIdPy}"
            Id: !Sub "front-py-thanos-reg-${env}"
            DomainName: !Sub "front-py-thanos-reg-${env}.s3.${AWS::Region}.amazonaws.com"

  #Creacion API y metodos
  #Partes de la api RestApi/Resource/Method + Autorizador
  #Autorizador API

  #Recursos de Metodos
  ResourceAr:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !GetAtt ApiGatewayReg.RootResourceId
      PathPart: "ar"
  ResourceArFechaActualizacion:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !Ref ResourceAr
      PathPart: "fecha-actualizacion"
  ResourceArFiltros:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !Ref ResourceAr
      PathPart: "filtros"
  ResourceArMenu:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !Ref ResourceAr
      PathPart: "menu"
  ResourceArPosicionDeCarga:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !Ref ResourceAr
      PathPart: "posicion-de-carga"
  ResourceArPosicionDeCargaPallet:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !Ref ResourceArPosicionDeCarga
      PathPart: "pallet"
  ResourceArPosicionDeCargaTabla:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !Ref ResourceArPosicionDeCarga
      PathPart: "tabla"
  ResourceArStatusCentro:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !Ref ResourceAr
      PathPart: "status-centro"
  ResourceArStatusCentroGraficos:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !Ref ResourceArStatusCentro
      PathPart: "graficos"
  ResourceArStatusCentroTablas:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !Ref ResourceArStatusCentro
      PathPart: "tablas"
  ResourceArStatusTransporte:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !Ref ResourceAr
      PathPart: "status-transporte"
  ResourcePy:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !GetAtt ApiGatewayReg.RootResourceId
      PathPart: "py"
  ResourcePyFechaActualizacion:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !Ref ResourcePy
      PathPart: "fecha-actualizacion"
  ResourcePyFiltros:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !Ref ResourcePy
      PathPart: "filtros"
  ResourcePyMenu:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !Ref ResourcePy
      PathPart: "menu"
  ResourcePyPosicionDeCarga:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !Ref ResourcePy
      PathPart: "posicion-de-carga"
  ResourcePyPosicionDeCargaPallet:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !Ref ResourcePyPosicionDeCarga
      PathPart: "pallet"
  ResourcePyPosicionDeCargaTabla:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !Ref ResourcePyPosicionDeCarga
      PathPart: "tabla"
  ResourcePyStatusCentro:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !Ref ResourcePy
      PathPart: "status-centro"
  ResourcePyStatusCentroGraficos:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !Ref ResourcePyStatusCentro
      PathPart: "graficos"
  ResourcePyStatusCentroTablas:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !Ref ResourcePyStatusCentro
      PathPart: "tablas"
  ResourcePyStatusTransporte:
    Type: AWS::ApiGateway::Resource
    Properties:
      RestApiId: !Ref ApiGatewayReg
      ParentId: !Ref ResourcePy
      PathPart: "status-transporte"

  #ApiGateway
  ApiGatewayReg:
    Type: AWS::ApiGateway::RestApi
    Properties:
      EndpointConfiguration:
        Types:
          - REGIONAL
      Name: "thanos-reg"
      #Name: !Sub '${apiGatewayName}-${env}'

  #Definicion parametros API
  #Metodos Argentina
  ApiGatewayArFechaActualizacionOptions:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: fecha-actualizacion-option
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: OPTIONS
      Integration:
        #PassthroughBehavior: NEVER
        IntegrationHttpMethod: OPTIONS
        Type: MOCK
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
        RequestTemplates:
          application/json: ""
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourceArFechaActualizacion

  ApiGatewayArFechaActualizacionGet:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: fecha-actualizacion
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: GET
      Integration:
        IntegrationHttpMethod: GET
        Type: AWS_PROXY
        Uri: !Sub
          - arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${lambdaArn}/invocations
          - lambdaArn: !GetAtt LambdaDateupdateApiA.Arn
        RequestTemplates:
          application/json: ""
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourceArFechaActualizacion

  ApiGatewayArFiltrosOptions:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: filtros-option
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: OPTIONS
      Integration:
        #IntegrationHttpMethod: OPTIONS
        Type: MOCK
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
        RequestTemplates:
          application/json: ""
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourceArFiltros

  ApiGatewayArFiltrosGet:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: filtros
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: GET
      Integration:
        IntegrationHttpMethod: GET
        Type: AWS_PROXY
        Uri: !Sub
          - arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${lambdaArn}/invocations
          - lambdaArn: !GetAtt LambdaFiltrosApiA.Arn
        RequestTemplates:
          application/json: ""
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourceArFiltros

  ApiGatewayArMenuOptions:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: menu-option
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: OPTIONS
      Integration:
        #PassthroughBehavior: NEVER
        IntegrationHttpMethod: OPTIONS
        Type: MOCK
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
        RequestTemplates:
          application/json: ""
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourceArMenu

  ApiGatewayArMenuGet:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: menu
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: GET
      Integration:
        IntegrationHttpMethod: GET
        Type: AWS_PROXY
        Uri: !Sub
          - arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${lambdaArn}/invocations
          - lambdaArn: !GetAtt LambdaMenuApiA.Arn
        RequestTemplates:
          application/json: ""
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourceArMenu

  ApiGatewayArPosicionDeCargaPalletOptions:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: posicion-de-carga-pallet-option
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: OPTIONS
      Integration:
        #PassthroughBehavior: NEVER
        IntegrationHttpMethod: OPTIONS
        Type: MOCK
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
        RequestTemplates:
          application/json: ""
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourceArPosicionDeCargaPallet

  ApiGatewayArPosicionDeCargaPalletGet:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: posicion-de-carga-pallet
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: GET
      Integration:
        IntegrationHttpMethod: GET
        Type: AWS_PROXY
        Uri: !Sub
          - arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${lambdaArn}/invocations
          - lambdaArn: !GetAtt LambdaStatusPosicionCargaPApiA.Arn
        RequestTemplates:
          application/json: ""
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourceArPosicionDeCargaPallet

  ApiGatewayArPosicionDeCargaTablaOptions:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: posicion-de-carga-tabla-option
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: OPTIONS
      Integration:
        #PassthroughBehavior: NEVER
        IntegrationHttpMethod: OPTIONS
        Type: MOCK
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
        RequestTemplates:
          application/json: ""
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourceArPosicionDeCargaTabla

  ApiGatewayArPosicionDeCargaTablaGet:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: posicion-de-carga-tabla
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: GET
      Integration:
        IntegrationHttpMethod: GET
        Type: AWS_PROXY
        Uri: !Sub
          - arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${lambdaArn}/invocations
          - lambdaArn: !GetAtt LambdaStatusPosicionCargaApiA.Arn
        RequestTemplates:
          application/json: ""
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourceArPosicionDeCargaTabla

  ApiGatewayArStatusCentroGraficosOptions:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: status-centro-graficos-option
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: OPTIONS
      Integration:
        #PassthroughBehavior: NEVER
        IntegrationHttpMethod: OPTIONS
        Type: MOCK
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
        RequestTemplates:
          application/json: ""
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourceArStatusCentroGraficos

  ApiGatewayArStatusCentroGraficosGet:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: status-centro-graficos
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: GET
      Integration:
        IntegrationHttpMethod: GET
        Type: AWS_PROXY
        Uri: !Sub
          - arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${lambdaArn}/invocations
          - lambdaArn: !GetAtt LambdaStatusCentroCApiA.Arn
        RequestTemplates:
          application/json: ""
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourceArStatusCentroGraficos

  ApiGatewayArStatusCentroTablasOptions:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: status-centro-tablas-option
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: OPTIONS
      Integration:
        #PassthroughBehavior: NEVER
        IntegrationHttpMethod: OPTIONS
        Type: MOCK
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
        RequestTemplates:
          application/json: ""
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourceArStatusCentroTablas

  ApiGatewayArStatusCentroTablasGet:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: status-centro-tablas
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: GET
      Integration:
        IntegrationHttpMethod: GET
        Type: AWS_PROXY
        Uri: !Sub
          - arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${lambdaArn}/invocations
          - lambdaArn: !GetAtt LambdaStatusCentroTApiA.Arn
        RequestTemplates:
          application/json: ""
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourceArStatusCentroTablas

  ApiGatewayArStatusTransporteOptions:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: status-transporte-option
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: OPTIONS
      Integration:
        #PassthroughBehavior: NEVER
        IntegrationHttpMethod: OPTIONS
        Type: MOCK
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
        RequestTemplates:
          application/json: ""
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourceArStatusTransporte

  ApiGatewayArStatusTransporteGet:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: status-transporte
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: GET
      Integration:
        IntegrationHttpMethod: GET
        Type: AWS_PROXY
        Uri: !Sub
          - arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${lambdaArn}/invocations
          - lambdaArn: !GetAtt LambdaStatusTransportesApiA.Arn
        RequestTemplates:
          application/json: ""
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourceArStatusTransporte

  ##Metodos Paraguay
  ApiGatewayPyFechaActualizacionOptions:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: fecha-actualizacion-option
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: OPTIONS
      Integration:
        #PassthroughBehavior: NEVER
        IntegrationHttpMethod: OPTIONS
        Type: MOCK
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
        RequestTemplates:
          application/json: ""
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourcePyFechaActualizacion

  ApiGatewayPyFechaActualizacionGet:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: fecha-actualizacion
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: GET
      Integration:
        IntegrationHttpMethod: GET
        Type: AWS_PROXY
        Uri: !Sub
          - arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${lambdaArn}/invocations
          - lambdaArn: !GetAtt LambdaDateupdateApiP.Arn
        RequestTemplates:
          application/json: ""
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourcePyFechaActualizacion

  ApiGatewayPyFiltrosOptions:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: filtros-option
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: OPTIONS
      Integration:
        #IntegrationHttpMethod: OPTIONS
        Type: MOCK
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
        RequestTemplates:
          application/json: ""
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourcePyFiltros

  ApiGatewayPyFiltrosGet:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: filtros
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: GET
      Integration:
        IntegrationHttpMethod: GET
        Type: AWS_PROXY
        Uri: !Sub
          - arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${lambdaArn}/invocations
          - lambdaArn: !GetAtt LambdaFiltrosApiP.Arn
        RequestTemplates:
          application/json: ""
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourcePyFiltros

  ApiGatewayPyMenuOptions:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: menu-option
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: OPTIONS
      Integration:
        #PassthroughBehavior: NEVER
        IntegrationHttpMethod: OPTIONS
        Type: MOCK
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
        RequestTemplates:
          application/json: ""
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourcePyMenu

  ApiGatewayPyMenuGet:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: menu
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: GET
      Integration:
        IntegrationHttpMethod: GET
        Type: AWS_PROXY
        Uri: !Sub
          - arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${lambdaArn}/invocations
          - lambdaArn: !GetAtt LambdaMenuApiP.Arn
        RequestTemplates:
          application/json: ""
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourcePyMenu

  ApiGatewayPyPosicionDeCargaPalletOptions:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: posicion-de-carga-pallet-option
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: OPTIONS
      Integration:
        #PassthroughBehavior: NEVER
        IntegrationHttpMethod: OPTIONS
        Type: MOCK
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
        RequestTemplates:
          application/json: ""
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourcePyPosicionDeCargaPallet

  ApiGatewayPyPosicionDeCargaPalletGet:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: posicion-de-carga-pallet
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: GET
      Integration:
        IntegrationHttpMethod: GET
        Type: AWS_PROXY
        Uri: !Sub
          - arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${lambdaArn}/invocations
          - lambdaArn: !GetAtt LambdaStatusPosicionCargaPApiP.Arn
        RequestTemplates:
          application/json: ""
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourcePyPosicionDeCargaPallet

  ApiGatewayPyPosicionDeCargaTablaOptions:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: posicion-de-carga-tabla-option
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: OPTIONS
      Integration:
        #PassthroughBehavior: NEVER
        IntegrationHttpMethod: OPTIONS
        Type: MOCK
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
        RequestTemplates:
          application/json: ""
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourcePyPosicionDeCargaTabla

  ApiGatewayPyPosicionDeCargaTablaGet:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: posicion-de-carga-tabla
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: GET
      Integration:
        IntegrationHttpMethod: GET
        Type: AWS_PROXY
        Uri: !Sub
          - arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${lambdaArn}/invocations
          - lambdaArn: !GetAtt LambdaStatusPosicionCargaApiP.Arn
        RequestTemplates:
          application/json: ""
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourcePyPosicionDeCargaTabla

  ApiGatewayPyStatusCentroGraficosOptions:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: status-centro-graficos-option
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: OPTIONS
      Integration:
        #PassthroughBehavior: NEVER
        IntegrationHttpMethod: OPTIONS
        Type: MOCK
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
        RequestTemplates:
          application/json: ""
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourcePyStatusCentroGraficos

  ApiGatewayPyStatusCentroGraficosGet:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: status-centro-graficos
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: GET
      Integration:
        IntegrationHttpMethod: GET
        Type: AWS_PROXY
        Uri: !Sub
          - arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${lambdaArn}/invocations
          - lambdaArn: !GetAtt LambdaStatusCentroCApiP.Arn
        RequestTemplates:
          application/json: ""
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourcePyStatusCentroGraficos

  ApiGatewayPyStatusCentroTablasOptions:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: status-centro-tablas-option
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: OPTIONS
      Integration:
        #PassthroughBehavior: NEVER
        IntegrationHttpMethod: OPTIONS
        Type: MOCK
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
        RequestTemplates:
          application/json: ""
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourcePyStatusCentroTablas

  ApiGatewayPyStatusCentroTablasGet:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: status-centro-tablas
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: GET
      Integration:
        IntegrationHttpMethod: GET
        Type: AWS_PROXY
        Uri: !Sub
          - arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${lambdaArn}/invocations
          - lambdaArn: !GetAtt LambdaStatusCentroTApiP.Arn
        RequestTemplates:
          application/json: ""
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourcePyStatusCentroTablas

  ApiGatewayPyStatusTransporteOptions:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: status-transporte-option
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: OPTIONS
      Integration:
        #PassthroughBehavior: NEVER
        IntegrationHttpMethod: OPTIONS
        Type: MOCK
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
        RequestTemplates:
          application/json: ""
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourcePyStatusTransporte

  ApiGatewayPyStatusTransporteGet:
    Type: AWS::ApiGateway::Method
    Properties:
      OperationName: status-transporte
      ApiKeyRequired: false
      AuthorizationType: NONE
      #AuthorizerId: !Ref apiGatewayAuthorizer
      HttpMethod: GET
      Integration:
        IntegrationHttpMethod: GET
        Type: AWS_PROXY
        Uri: !Sub
          - arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${lambdaArn}/invocations
          - lambdaArn: !GetAtt LambdaStatusTransportesApiP.Arn
        RequestTemplates:
          application/json: ""
        IntegrationResponses:
          - StatusCode: 200
            ResponseTemplates:
              application/json: Empty
      MethodResponses:
        - StatusCode: 200
          ResponseModels:
            application/json: Empty
          ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Methods: true
            method.response.header.Access-Control-Allow-Origin: true
      RestApiId: !Ref ApiGatewayReg
      ResourceId: !Ref ResourcePyStatusTransporte
